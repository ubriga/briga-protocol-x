<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Briga Games: Protocol X</title>
    <script src="https://cdn.jsdelivr.net/npm/disable-devtool@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        body { margin: 0; overflow: hidden; background: #050505; color: #fff; font-family: 'Orbitron', sans-serif; user-select: none; }
        #gameCanvas { display: block; }
        
        /* HUD */
        .hud { position: absolute; pointer-events: none; text-shadow: 0 0 10px cyan; z-index: 10; }
        #scoreBoard { top: 20px; right: 20px; text-align: right; }
        #healthBarContainer { top: 20px; left: 50%; transform: translateX(-50%); width: 300px; height: 20px; border: 2px solid cyan; border-radius: 10px; overflow: hidden; background: rgba(0,0,0,0.5); }
        #healthBar { width: 100%; height: 100%; background: linear-gradient(90deg, #ff0055, #ff5500); transition: width 0.2s; }
        
        /* SHOP */
        #shop { position: absolute; bottom: 20px; left: 20px; display: flex; gap: 10px; z-index: 20; }
        .upgrade-btn { background: rgba(0,20,40,0.9); border: 1px solid cyan; color: cyan; padding: 10px 15px; cursor: pointer; text-align: center; font-family: inherit; transition: 0.2s; min-width: 100px; }
        .upgrade-btn:hover { background: rgba(0,255,255,0.2); transform: translateY(-3px); }
        .upgrade-btn.disabled { opacity: 0.5; cursor: not-allowed; border-color: #555; color: #555; transform: none; }

        /* SCREENS */
        #menuOverlay, #leaderboardOverlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        #leaderboardOverlay { display: none; }
        
        h1 { font-size: 60px; color: cyan; text-shadow: 0 0 20px cyan; margin: 0; letter-spacing: 5px; }
        input { background: transparent; border: 2px solid cyan; color: white; padding: 10px; font-size: 20px; text-align: center; margin: 20px; font-family: inherit; }
        button.cta { background: #ff0055; color: white; border: none; padding: 15px 40px; font-size: 24px; cursor: pointer; font-family: inherit; margin-top: 10px; }
        button.cta:hover { background: #ff2277; box-shadow: 0 0 20px #ff0055; }

        /* LEADERBOARD TABLE */
        table { border-collapse: collapse; width: 60%; margin-top: 20px; color: #fff; }
        th, td { border-bottom: 1px solid #333; padding: 10px; text-align: center; }
        th { color: cyan; font-size: 1.2em; }
        tr:nth-child(1) td { color: gold; font-weight: bold; } /* 1st Place */
        tr:nth-child(2) td { color: silver; } /* 2nd Place */
        tr:nth-child(3) td { color: #cd7f32; } /* 3rd Place */

        /* Version & Credits */
        #version { position: absolute; top: 5px; left: 10px; font-size: 12px; color: #888; z-index: 30; }
        #credits { position: absolute; bottom: 5px; left: 10px; font-size: 11px; color: #666; z-index: 30; text-align: left; }
        #credits a { color: cyan; text-decoration: none; }
        #credits a:hover { text-decoration: underline; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="gameCanvasWrapper"><canvas id="gameCanvas"></canvas></div>

    <!-- VERSION & CREDITS -->
    <div id="version">v1.1</div>
    <div id="credits">
        נוצר על ידי <strong>OrelAI</strong><br>
        <a href="mailto:ubriga@gmail.com">ubriga@gmail.com</a>
    </div>

    <!-- HUD -->
    <div class="hud" id="healthBarContainer"><div id="healthBar"></div></div>
    <div class="hud" id="scoreBoard">
        <div>SCORE: <span id="scoreVal">0</span></div>
        <div style="color: gold; font-size: 18px;">CREDITS: <span id="moneyVal">0</span></div>
        <div style="font-size: 14px; margin-top:5px; color:#aaa;">WAVE: <span id="waveVal">1</span></div>
    </div>

    <!-- SHOP -->
    <div id="shop">
        <div class="upgrade-btn" id="btnDmg" onclick="game.buy('d')">DAMAGE<br><small id="costDmg">100</small> [1]</div>
        <div class="upgrade-btn" id="btnSpeed" onclick="game.buy('s')">SPEED<br><small id="costSpeed">150</small> [2]</div>
        <div class="upgrade-btn" id="btnHeal" onclick="game.buy('h')">REPAIR<br><small id="costHeal">200</small> [3]</div>
    </div>

    <!-- START MENU -->
    <div id="menuOverlay">
        <h1>BRIGA GAMES</h1>
        <h2>PROTOCOL X</h2>
        <input type="text" id="playerName" placeholder="ENTER PILOT NAME" maxlength="12">
        <button class="cta" onclick="game.init()">LAUNCH MISSION</button>
        <div style="margin-top: 20px; cursor: pointer; text-decoration: underline;" onclick="game.showLeaderboard()">View Leaderboard</div>
    </div>

    <!-- LEADERBOARD SCREEN -->
    <div id="leaderboardOverlay">
        <h1>TOP PILOTS</h1>
        <table id="lbTable">
            <thead><tr><th>RANK</th><th>PILOT</th><th>WAVE</th><th>SCORE</th></tr></thead>
            <tbody id="lbBody"></tbody>
        </table>
        <button class="cta" onclick="document.getElementById('leaderboardOverlay').style.display='none'" style="margin-top:30px;">CLOSE</button>
    </div>

<script>
/**
 * BRIGA GAMES ENGINE - FULL INTEGRATION v1.1
 */
const API_URL = "https://ubriga.pythonanywhere.com"; // כתובת השרת שלנו
const SECRET_KEY = "BrigaProtoX_Secure_2025"; // חייב להיות תואם לשרת

// HASHING FUNCTION (Simple Implementation for Browser)
async function sha256(message) {
    const msgBuffer = new TextEncoder().encode(message);
    const hashBuffer = await crypto.subtle.digest('SHA-256',
